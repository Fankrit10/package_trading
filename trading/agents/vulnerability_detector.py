"""
Module for creating a vulnerability detection agent.

This agent specializes in scanning and identifying security vulnerabilities
in source code files, focusing on common OWASP Top 10 and CWE vulnerabilities.
"""
# pylint: disable=R0801

import os
from typing import List
from crewai import Agent, LLM
from crewai.tools import BaseTool
from dotenv import load_dotenv

load_dotenv()


def create_vulnerability_detector(tools: List[BaseTool]) -> Agent:
    """
    Creates and configures an agent specialized in vulnerability detection.

    This agent scans source code to identify potential security vulnerabilities,
    including SQL injection, XSS, command injection, and other common attacks.

    Args:
        tools (List[BaseTool]): A list of tools the agent can use for detection.

    Returns:
        Agent: A configured CrewAI Agent instance for vulnerability detection.
    """
    llm = LLM(
        model=os.getenv("OPENAI_MODEL_NAME", "gpt-4o"),
        api_key=os.getenv("OPENAI_API_KEY")
    )

    return Agent(
        role="Vulnerability Detection Specialist",
        goal=(
            "Scan source code files to identify and catalog security vulnerabilities, "
            "focusing on OWASP Top 10 and common CWE patterns"
        ),
        backstory=(
            "You are an expert code security scanner with deep knowledge of "
            "vulnerability patterns and attack vectors. "
            "You have experience scanning enterprise applications for security issues "
            "and can quickly identify vulnerable code patterns. "
            "You understand the business context and can prioritize findings by severity."
        ),
        tools=tools,
        llm=llm,
        verbose=True,
        allow_delegation=False,
        memory=True,
    )

