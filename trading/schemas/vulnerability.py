"""
Schema definitions for vulnerability reporting and classification.

This module defines data models and enumerations used to represent
application vulnerabilities, including their severity, type, and contextual
information. These schemas are used throughout the security analysis
and remediation workflow to structure vulnerability data consistently.
"""

from typing import Optional, List
from enum import Enum
from pydantic import BaseModel, Field


class SeverityLevel(str, Enum):
    """
    Enumeration of vulnerability severity levels.

    Defines the impact level associated with a detected vulnerability.

    Attributes:
        CRITICAL: Indicates a severe vulnerability that poses immediate risk.
        HIGH: A high-impact issue requiring prompt remediation.
        MEDIUM: A moderate-risk issue that should be addressed soon.
        LOW: A low-severity vulnerability with limited impact.
        INFO: An informational finding that does not represent a direct threat.
    """
    CRITICAL = "critical"
    HIGH = "high"
    MEDIUM = "medium"
    LOW = "low"
    INFO = "info"


class VulnerabilityType(str, Enum):
    """
    Enumeration of supported vulnerability types.

    Represents common categories of software security vulnerabilities
    identified during code scanning and analysis.

    Attributes:
        SQL_INJECTION: SQL injection vulnerability.
        XSS: Cross-Site Scripting vulnerability.
        COMMAND_INJECTION: Command injection vulnerability.
        PROMPT_INJECTION: Prompt injection (AI-related) vulnerability.
        INSECURE_DESERIALIZATION: Insecure deserialization vulnerability.
    """
    SQL_INJECTION = "SQL Injection"
    XSS = "Cross-Site Scripting (XSS)"
    COMMAND_INJECTION = "Command Injection"
    PROMPT_INJECTION = "Prompt Injection"
    INSECURE_DESERIALIZATION = "Insecure Deserialization"


class Vulnerability(BaseModel):
    """
    Model representing a single detected vulnerability.

    Contains metadata describing the vulnerability, including its type,
    severity, affected file, and contextual details for remediation.

    Attributes:
        id (str): Unique identifier for the vulnerability.
        type (VulnerabilityType): The classification or type of the vulnerability.
        severity (SeverityLevel): The severity level indicating impact.
        file_path (str): Path to the file containing the vulnerability.
        line_number (int): Line number where the issue occurs.
        description (str): Detailed explanation of the vulnerability.
        payload (Optional[str]): Payload or exploit example, if applicable.
        cwe_id (Optional[str]): CWE identifier associated with the vulnerability.
        owasp_category (Optional[str]): OWASP Top 10 category classification.
    """
    id: str = Field(..., description="Unique identifier for the vulnerability")
    type: VulnerabilityType = Field(..., description="Type of vulnerability")
    severity: SeverityLevel = Field(..., description="Severity level")
    file_path: str = Field(..., description="Path to the vulnerable file")
    line_number: int = Field(..., description="Line number where vulnerability exists")
    description: str = Field(..., description="Detailed description of the vulnerability")
    payload: Optional[str] = Field(None, description="Payload used to exploit")
    cwe_id: Optional[str] = Field(None, description="CWE identifier")
    owasp_category: Optional[str] = Field(None, description="OWASP Top 10 category")


class VulnerabilityReport(BaseModel):
    """
    Model representing a complete vulnerability report for an application.

    Aggregates multiple detected vulnerabilities and provides summary information
    about the scan, including metadata such as the application name and scan date.

    Attributes:
        application (str): The name of the scanned application.
        scan_date (str): The date when the scan was performed.
        total_vulnerabilities (int): Total number of vulnerabilities detected.
        vulnerabilities (List[Vulnerability]): List of detected vulnerabilities.
    """
    application: str = Field(..., description="Name of the application")
    scan_date: str = Field(..., description="Date of vulnerability scan")
    total_vulnerabilities: int = Field(..., description="Total number of vulnerabilities")
    vulnerabilities: List[Vulnerability] = Field(..., description="List of vulnerabilities")
